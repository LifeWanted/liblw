load("@rules_foreign_cc//foreign_cc:defs.bzl", "configure_make")

# See https://wiki.openssl.org/index.php/Compilation_and_Installation
# See https://github.com/bazelbuild/rules_foreign_cc/issues/338
configure_make(
  name = "openssl",
  configure_command = "Configure",
  configure_options = [
    "no-buildtest-c++", "no-comp", "no-deprecated", "no-des",
    "no-external-tests", "no-legacy", "no-makedepend", "no-md2", "no-md4",
    "no-shared", "no-ssl2", "no-ssl3", "no-tests", "no-ui-console",
    "no-unit-test", "no-weak-ssl-ciphers", "no-zlib",
  ],
  args = ["-j"],
  linkopts = ["-ldl", "-pthread"],
  lib_source = "@openssl//:all",
  visibility = ["//visibility:public"],
  out_lib_dir = "lib64",
  out_static_libs = [
    "libssl.a",
    "libcrypto.a",
  ],
)
